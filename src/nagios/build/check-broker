#!/bin/sh

cwd=`pwd`
path=`dirname $cwd/$0`
classname='com.trendmicro.nagios.BkCheck'
javacmd="/usr/java/latest/bin/java"

if [ ! -x "$javacmd" ]; then
    echo "Sun Java Runtime Environment: $javacmd not found"
    exit 1
fi

if [ -z "$1" ]; then
    echo "Need broker's host, for example, $0 10.1.100.113:7676"
    exit 1
fi

$javacmd -cp "$path/*" $classname -h "$1"
ret=$?
if [ "$ret" -eq 0 ]; then
   echo "OK:[broker@$1] is alive"
elif [ "$ret" -eq 1 ]; then
   echo "WARNING:[broker@$1] connection is ok but verification is not correct"
else
   echo "CRITICAL:[broker@$1] can't be connected"
fi
exit $ret
