#!/bin/sh

cwd=`pwd`
path=`dirname $cwd/$0`
classname='com.trendmicro.nagios.PtCheck'
javacmd="/usr/java/latest/bin/java"

if [ ! -x "$javacmd" ]; then
    echo "Sun Java Runtime Environment: $javacmd not found"
    exit 1
fi

if [ -z "$1" ]; then
   echo "Need portal's host, for example, $0 10.1.100.113:80 [web_dir]"
   exit 1
fi
if [ -z "$2" ]; then
   $javacmd -cp "$path/*" $classname -h "$1"
else
   $javacmd -cp "$path/*" $classname -h "$1" -d "$2"
fi

ret=$?
if [ "$ret" -eq 0 ]; then
   echo "OK:[portal@$1] is alive"
elif [ "$ret" -eq 1 ]; then
   echo "WARNING:[portal@$1] connection is ok but web verification is not correct"
else
   echo "CRITICAL:[portal@$1] can't be connected"
fi

exit $ret
